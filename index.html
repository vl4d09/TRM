<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Demo</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        
        .debug-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
        }
        
        .controls button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Debug Panel -->
    <div class="debug-panel" id="debug">
        <div><strong>Debug Info:</strong></div>
        <div>Camera: <span id="camera-status">Loading...</span></div>
        <div>AR.js: <span id="arjs-status">Loading...</span></div>
        <div>Marker: <span id="marker-status">Not Found</span></div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <div style="margin-bottom: 10px;">
            <strong>Print this marker:</strong><br>
            <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" 
               target="_blank" style="color: #4CAF50;">Download Hiro Marker</a>
        </div>
        <button id="test-btn">Test Visibility</button>
    </div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono;">

        <a-assets>
            <!-- Preload your GLB models here later -->
        </a-assets>

        <!-- Lighting -->
        <a-entity light="type: ambient; intensity: 0.5;"></a-entity>
        <a-entity light="type: directional; intensity: 0.6" position="-0.5 1 1"></a-entity>

        <!-- Hiro Pattern Marker (TEST) -->
        <a-marker id="hiro-marker" preset="hiro" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
            <!-- Red spinning box for testing -->
            <a-box 
                position="0 0.5 0" 
                material="color: red;" 
                scale="1 1 1"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
            </a-box>
            
            <!-- Text label -->
            <a-text 
                value="MARKER WORKS!" 
                align="center" 
                position="0 1.5 0" 
                color="#FF0000"
                scale="2 2 2">
            </a-text>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const cameraStatus = document.getElementById('camera-status');
        const arjsStatus = document.getElementById('arjs-status');
        const markerStatus = document.getElementById('marker-status');
        const testBtn = document.getElementById('test-btn');
        
        const scene = document.querySelector('a-scene');
        const marker = document.getElementById('hiro-marker');

        // Scene loaded
        scene.addEventListener('loaded', () => {
            console.log('‚úÖ A-Frame scene loaded');
            arjsStatus.textContent = 'Ready';
            arjsStatus.style.color = '#4CAF50';
        });

        // Camera ready
        scene.addEventListener('renderstart', () => {
            console.log('‚úÖ Camera started rendering');
            cameraStatus.textContent = 'Active';
            cameraStatus.style.color = '#4CAF50';
        });

        // Marker found
        marker.addEventListener('markerFound', () => {
            console.log('üéØ MARKER FOUND!');
            markerStatus.textContent = 'FOUND!';
            markerStatus.style.color = '#4CAF50';
        });

        // Marker lost
        marker.addEventListener('markerLost', () => {
            console.log('‚ùå Marker lost');
            markerStatus.textContent = 'Lost';
            markerStatus.style.color = '#ff9800';
        });

        // Test button - makes box visible without marker
        testBtn.addEventListener('click', () => {
            const box = document.querySelector('a-box');
            if (box) {
                const currentVisible = box.getAttribute('visible');
                box.setAttribute('visible', !currentVisible);
                console.log('Box visibility toggled:', !currentVisible);
            }
        });

        // Check camera permissions
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(() => {
                console.log('‚úÖ Camera permission granted');
            })
            .catch((err) => {
                console.error('‚ùå Camera error:', err);
                cameraStatus.textContent = 'DENIED!';
                cameraStatus.style.color = '#f44336';
                alert('Camera access required! Please enable camera permissions in your browser settings.');
            });

        console.log('üöÄ Script loaded. Show the Hiro marker to the camera...');
    </script>
</body>
</html>