<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Demo - Random Path</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        
        .status-bar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 280px;
        }
        
        .path-info {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .marker-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .marker-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }
        
        .marker-status .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }
        
        .marker-status.unlocked .dot {
            background: #4CAF50;
        }
        
        .marker-status.locked .dot {
            background: #f44336;
        }
        
        .marker-status.active .dot {
            background: #2196F3;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        .message {
            position: fixed;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: Arial, sans-serif;
            display: none;
            font-size: 16px;
            max-width: 80%;
            text-align: center;
        }
        
        .message.show {
            display: block;
            animation: fadeOut 3s forwards;
        }
        
        .message.error {
            background: rgba(244, 67, 54, 0.9);
        }
        
        .message.success {
            background: rgba(76, 175, 80, 0.9);
        }
        
        @keyframes fadeOut {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="path-info" id="path-info">Scan Marker 1 to start</div>
        <div class="marker-row">
            <div class="marker-status unlocked" id="status1">
                <span class="dot"></span>
                <span>Marker 1</span>
            </div>
            <div class="marker-status locked" id="status2">
                <span class="dot"></span>
                <span>Marker 2</span>
            </div>
            <div class="marker-status locked" id="status3">
                <span class="dot"></span>
                <span>Marker 3</span>
            </div>
        </div>
    </div>
    
    <!-- Message popup -->
    <div class="message" id="message"></div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; alpha: true;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">

        <a-assets>
            <a-asset-item id="model1" src="./models/model1.glb"></a-asset-item>
            <a-asset-item id="model2" src="./models/model2.glb"></a-asset-item>
            <a-asset-item id="model3" src="./models/model3.glb"></a-asset-item>
            <a-asset-item id="model4" src="./models/model4.glb"></a-asset-item>
        </a-assets>

        <!-- Lighting -->
        <a-entity light="type: ambient; intensity: 0.8;"></a-entity>
        <a-entity light="type: directional; intensity: 0.6" position="-1 2 1"></a-entity>

        <!-- NFT Marker 1 -->
        <a-nft 
            id="nft1" 
            type="nft" 
            url="./marker1" 
            smooth="true" 
            smoothCount="10" 
            smoothTolerance="0.01" 
            smoothThreshold="5">
            
            <!-- Path A: Model 1 -->
            <a-entity 
                id="model1-entity"
                gltf-model="#model1"
                scale="2 2 2"
                position="60 150 -150"
                rotation="0 180 0"
                visible="false">
            </a-entity>
            
            <!-- Path B: Model 4 -->
            <a-entity 
                id="model4-m1-entity"
                gltf-model="#model4"
                scale="20 20 20"
                position="60 150 -150"
                rotation="0 180 0"
                visible="false">
            </a-entity>
        </a-nft>

        <!-- NFT Marker 2 -->
        <a-nft 
            id="nft2" 
            type="nft" 
            url="./marker2" 
            smooth="true" 
            smoothCount="10" 
            smoothTolerance="0.01" 
            smoothThreshold="5">
            
            <!-- Path A: Model 2 -->
            <a-entity 
                id="model2-entity"
                gltf-model="#model2"
                scale="400 400 400"
                position="0 45 -150"
                rotation="90 180 0"
                visible="false">
            </a-entity>
            
            <!-- Path B: Model 4 -->
            <a-entity 
                id="model4-m2-entity"
                gltf-model="#model4"
                scale="20 20 20"
                position="0 150 -150"
                rotation="0 180 0"
                visible="false">
            </a-entity>
        </a-nft>

        <!-- NFT Marker 3 -->
        <a-nft 
            id="nft3" 
            type="nft" 
            url="./marker3" 
            smooth="true" 
            smoothCount="10" 
            smoothTolerance="0.01" 
            smoothThreshold="5">
            
            <!-- Path A: Model 3 -->
            <a-entity 
                id="model3-entity"
                gltf-model="#model3"
                scale="100 100 100"
                position="0 45 -150"
                rotation="90 180 0"
                visible="false">
            </a-entity>
            
            <!-- Path B: Model 4 -->
            <a-entity 
                id="model4-m3-entity"
                gltf-model="#model4"
                scale="20 20 20"
                position="0 150 -150"
                rotation="0 180 0"
                visible="false">
            </a-entity>
        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Track progress
        const progress = {
            chosenPath: null, // Will be 'pathA' (model1,2,3) or 'pathB' (model4,4,4)
            marker1: false,
            marker2: false,
            marker3: false
        };

        // Get elements
        const messageEl = document.getElementById('message');
        const pathInfo = document.getElementById('path-info');
        
        const status1 = document.getElementById('status1');
        const status2 = document.getElementById('status2');
        const status3 = document.getElementById('status3');
        
        const nft1 = document.getElementById('nft1');
        const nft2 = document.getElementById('nft2');
        const nft3 = document.getElementById('nft3');
        
        // Path A models (1, 2, 3)
        const model1Entity = document.getElementById('model1-entity');
        const model2Entity = document.getElementById('model2-entity');
        const model3Entity = document.getElementById('model3-entity');
        
        // Path B models (4, 4, 4)
        const model4M1Entity = document.getElementById('model4-m1-entity');
        const model4M2Entity = document.getElementById('model4-m2-entity');
        const model4M3Entity = document.getElementById('model4-m3-entity');

        function showMessage(text, type = 'info') {
            messageEl.textContent = text;
            messageEl.className = 'message show ' + type;
        }

        function updateStatusUI() {
            if (progress.marker1) {
                status2.className = 'marker-status unlocked';
            }
            if (progress.marker2) {
                status3.className = 'marker-status unlocked';
            }
        }

        // Marker 1 - Randomly choose path
        if (nft1) {
            nft1.addEventListener('markerFound', () => {
                status1.classList.add('active');
                
                if (!progress.marker1) {
                    // Random path selection (50/50 chance)
                    const randomPath = Math.random() < 0.5 ? 'pathA' : 'pathB';
                    progress.chosenPath = randomPath;
                    progress.marker1 = true;
                    
                    if (randomPath === 'pathA') {
                        // Show Model 1 (dog path)
                        model1Entity.setAttribute('visible', 'true');
                        model4M1Entity.setAttribute('visible', 'false');
                        pathInfo.textContent = 'ðŸ• Path A: With Dog';
                        showMessage('ðŸ• Path A chosen! Continue with dog.', 'success');
                    } else {
                        // Show Model 4 (human path)
                        model1Entity.setAttribute('visible', 'false');
                        model4M1Entity.setAttribute('visible', 'true');
                        pathInfo.textContent = 'ðŸ§ Path B: Alone';
                        showMessage('ðŸ§ Path B chosen! Continue alone.', 'success');
                    }
                    
                    updateStatusUI();
                } else {
                    // Already chose path, just show the correct model
                    if (progress.chosenPath === 'pathA') {
                        model1Entity.setAttribute('visible', 'true');
                        model4M1Entity.setAttribute('visible', 'false');
                    } else {
                        model1Entity.setAttribute('visible', 'false');
                        model4M1Entity.setAttribute('visible', 'true');
                    }
                }
            });
            
            nft1.addEventListener('markerLost', () => {
                status1.classList.remove('active');
            });
        }

        // Marker 2 - Follows chosen path
        if (nft2) {
            nft2.addEventListener('markerFound', () => {
                // Check if Marker 1 was scanned first
                if (!progress.marker1) {
                    showMessage('ðŸ”’ Scan Marker 1 first!', 'error');
                    model2Entity.setAttribute('visible', 'false');
                    model4M2Entity.setAttribute('visible', 'false');
                    return;
                }
                
                status2.classList.add('active');
                
                if (progress.chosenPath === 'pathA') {
                    // Show Model 2 (dog path)
                    model2Entity.setAttribute('visible', 'true');
                    model4M2Entity.setAttribute('visible', 'false');
                    
                    if (!progress.marker2) {
                        progress.marker2 = true;
                        updateStatusUI();
                        showMessage('ðŸ• Marker 2 complete! One more to go.', 'success');
                    }
                } else {
                    // Show Model 4 (human path)
                    model2Entity.setAttribute('visible', 'false');
                    model4M2Entity.setAttribute('visible', 'true');
                    
                    if (!progress.marker2) {
                        progress.marker2 = true;
                        updateStatusUI();
                        showMessage('ðŸ§ Marker 2 complete! One more to go.', 'success');
                    }
                }
            });
            
            nft2.addEventListener('markerLost', () => {
                status2.classList.remove('active');
            });
        }

        // Marker 3 - Final marker, follows chosen path
        if (nft3) {
            nft3.addEventListener('markerFound', () => {
                // Check if Marker 2 was scanned first
                if (!progress.marker2) {
                    showMessage('ðŸ”’ Scan Marker 2 first!', 'error');
                    model3Entity.setAttribute('visible', 'false');
                    model4M3Entity.setAttribute('visible', 'false');
                    return;
                }
                
                status3.classList.add('active');
                
                if (progress.chosenPath === 'pathA') {
                    // Show Model 3 (dog path)
                    model3Entity.setAttribute('visible', 'true');
                    model4M3Entity.setAttribute('visible', 'false');
                    
                    if (!progress.marker3) {
                        progress.marker3 = true;
                        showMessage('ðŸŽ‰ Path A Complete! Journey with dog finished!', 'success');
                        pathInfo.textContent = 'âœ… Path A Complete!';
                    }
                } else {
                    // Show Model 4 (human path)
                    model3Entity.setAttribute('visible', 'false');
                    model4M3Entity.setAttribute('visible', 'true');
                    
                    if (!progress.marker3) {
                        progress.marker3 = true;
                        showMessage('ðŸŽ‰ Path B Complete! Solo journey finished!', 'success');
                        pathInfo.textContent = 'âœ… Path B Complete!';
                    }
                }
            });
            
            nft3.addEventListener('markerLost', () => {
                status3.classList.remove('active');
            });
        }
    </script>
</body>
</html>